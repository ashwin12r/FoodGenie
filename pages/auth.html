<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login / Sign Up - FoodGenie</title>
    <link rel="stylesheet" href="../css/main.css" />
    <style>
        .tab-active {
            border-bottom: 3px solid #10B981;
            color: #10B981;
            font-weight: 600;
        }
        
        .tab-inactive {
            color: #6B7280;
        }
        
        .input-error {
            border-color: #EF4444 !important;
            border-width: 2px !important;
        }
        
        .error-message {
            color: #EF4444;
            font-size: 0.875rem;
            margin-top: 0.25rem;
        }
        
        .success-message {
            color: #10B981;
            font-size: 0.875rem;
            margin-top: 0.25rem;
        }
    </style>
</head>
<body class="bg-background min-h-screen">
    <!-- Navigation Header -->
    <nav class="bg-surface shadow-soft sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo -->
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <svg class="h-8 w-8 text-primary" viewBox="0 0 32 32" fill="currentColor">
                            <path d="M16 2C8.268 2 2 8.268 2 16s6.268 14 14 14 14-6.268 14-14S23.732 2 16 2zm0 4c1.657 0 3 1.343 3 3s-1.343 3-3 3-3-1.343-3-3 1.343-3 3-3zm-6 8c1.105 0 2 .895 2 2s-.895 2-2 2-2-.895-2-2 .895-2 2-2zm12 0c1.105 0 2 .895 2 2s-.895 2-2 2-2-.895-2-2 .895-2 2-2zm-6 6c2.21 0 4 1.79 4 4s-1.79 4-4 4-4-1.79-4-4 1.79-4 4-4z"/>
                        </svg>
                    </div>
                    <div class="ml-3">
                        <h1 class="text-xl font-bold text-primary">FoodGenie</h1>
                        <p class="text-xs text-text-secondary">Smart Kitchen Companion</p>
                    </div>
                </div>

                <!-- Desktop Navigation -->
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-4">
                        <a href="../index.html" class="text-text-secondary hover:text-primary px-3 py-2 rounded-md text-sm transition-smooth">Home</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Auth Container -->
    <div class="min-h-screen bg-gradient-to-br from-primary-50 to-secondary-50 flex items-center justify-center px-4 py-12">
        <div class="max-w-md w-full bg-white rounded-2xl shadow-xl p-8">
            <!-- Logo Header -->
            <div class="text-center mb-8">
                <svg class="h-16 w-16 text-primary mx-auto mb-4" viewBox="0 0 32 32" fill="currentColor">
                    <path d="M16 2C8.268 2 2 8.268 2 16s6.268 14 14 14 14-6.268 14-14S23.732 2 16 2zm0 4c1.657 0 3 1.343 3 3s-1.343 3-3 3-3-1.343-3-3 1.343-3 3-3zm-6 8c1.105 0 2 .895 2 2s-.895 2-2 2-2-.895-2-2 .895-2 2-2zm12 0c1.105 0 2 .895 2 2s-.895 2-2 2-2-.895-2-2 .895-2 2-2zm-6 6c2.21 0 4 1.79 4 4s-1.79 4-4 4-4-1.79-4-4 1.79-4 4-4z"/>
                </svg>
                <h1 class="text-3xl font-bold text-text-primary mb-2">Welcome to FoodGenie</h1>
                <p class="text-text-secondary">Your Smart Kitchen Companion</p>
            </div>

            <!-- Tabs -->
            <div class="flex border-b border-neutral-200 mb-6">
                <button onclick="switchTab('login')" id="login-tab" class="flex-1 py-3 text-center tab-active transition-all">
                    Login
                </button>
                <button onclick="switchTab('signup')" id="signup-tab" class="flex-1 py-3 text-center tab-inactive transition-all">
                    Sign Up
                </button>
            </div>

            <!-- Login Form -->
            <div id="login-form" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-text-primary mb-2">Email Address</label>
                    <input 
                        type="email" 
                        id="login-email" 
                        class="w-full px-4 py-3 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"
                        placeholder="your.email@example.com"
                        required
                    />
                    <div id="login-email-error" class="error-message hidden"></div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-text-primary mb-2">Password</label>
                    <input 
                        type="password" 
                        id="login-password" 
                        class="w-full px-4 py-3 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"
                        placeholder="Enter your password"
                        required
                    />
                    <div id="login-password-error" class="error-message hidden"></div>
                </div>

                <div id="login-message" class="hidden"></div>

                <button 
                    onclick="handleLogin(event)" 
                    class="w-full btn-primary py-3 text-lg font-semibold rounded-lg hover:shadow-lg transition-all"
                >
                    Login
                </button>

                <p class="text-center text-sm text-text-secondary">
                    Don't have an account? <button onclick="switchTab('signup')" class="text-primary hover:underline font-medium">Sign up</button>
                </p>
            </div>

            <!-- Signup Form -->
            <div id="signup-form" class="space-y-6 hidden">
                <div>
                    <label class="block text-sm font-medium text-text-primary mb-2">Full Name</label>
                    <input 
                        type="text" 
                        id="signup-name" 
                        class="w-full px-4 py-3 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"
                        placeholder="John Doe"
                        required
                    />
                    <div id="signup-name-error" class="error-message hidden"></div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-text-primary mb-2">Email Address</label>
                    <input 
                        type="email" 
                        id="signup-email" 
                        class="w-full px-4 py-3 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"
                        placeholder="your.email@example.com"
                        required
                    />
                    <div id="signup-email-error" class="error-message hidden"></div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-text-primary mb-2">Password</label>
                    <input 
                        type="password" 
                        id="signup-password" 
                        class="w-full px-4 py-3 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"
                        placeholder="Create a strong password"
                        required
                    />
                    <div id="signup-password-error" class="error-message hidden"></div>
                    <p class="text-xs text-text-secondary mt-1">Must be at least 6 characters</p>
                </div>

                <div>
                    <label class="block text-sm font-medium text-text-primary mb-2">City</label>
                    <select 
                        id="signup-city" 
                        class="w-full px-4 py-3 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"
                        required
                    >
                        <option value="Chennai">Chennai</option>
                        <option value="Mumbai">Mumbai</option>
                        <option value="Delhi">Delhi</option>
                        <option value="Bangalore">Bangalore</option>
                        <option value="Hyderabad">Hyderabad</option>
                        <option value="Kolkata">Kolkata</option>
                        <option value="Pune">Pune</option>
                        <option value="Ahmedabad">Ahmedabad</option>
                    </select>
                </div>

                <div id="signup-message" class="hidden"></div>

                <button 
                    onclick="handleSignup(event)" 
                    class="w-full btn-primary py-3 text-lg font-semibold rounded-lg hover:shadow-lg transition-all"
                >
                    Create Account
                </button>

                <p class="text-center text-sm text-text-secondary">
                    Already have an account? <button onclick="switchTab('login')" class="text-primary hover:underline font-medium">Login</button>
                </p>
            </div>
        </div>
    </div>

    <script src="api-client.js"></script>
    <script>
        const API_BASE_URL = 'http://localhost:8000';

        // Tab Switching
        function switchTab(tab) {
            const loginTab = document.getElementById('login-tab');
            const signupTab = document.getElementById('signup-tab');
            const loginForm = document.getElementById('login-form');
            const signupForm = document.getElementById('signup-form');

            if (tab === 'login') {
                loginTab.classList.add('tab-active');
                loginTab.classList.remove('tab-inactive');
                signupTab.classList.remove('tab-active');
                signupTab.classList.add('tab-inactive');
                loginForm.classList.remove('hidden');
                signupForm.classList.add('hidden');
            } else {
                signupTab.classList.add('tab-active');
                signupTab.classList.remove('tab-inactive');
                loginTab.classList.remove('tab-active');
                loginTab.classList.add('tab-inactive');
                signupForm.classList.remove('hidden');
                loginForm.classList.add('hidden');
            }
        }

        // Validation
        function validateEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }

        function showError(fieldId, message) {
            const field = document.getElementById(fieldId);
            const errorDiv = document.getElementById(`${fieldId}-error`);
            field.classList.add('input-error');
            errorDiv.textContent = message;
            errorDiv.classList.remove('hidden');
        }

        function clearError(fieldId) {
            const field = document.getElementById(fieldId);
            const errorDiv = document.getElementById(`${fieldId}-error`);
            field.classList.remove('input-error');
            errorDiv.classList.add('hidden');
        }

        function showMessage(messageId, message, isError = false) {
            const messageDiv = document.getElementById(messageId);
            messageDiv.textContent = message;
            messageDiv.className = isError ? 'error-message text-center' : 'success-message text-center';
            messageDiv.classList.remove('hidden');
        }

        // Login Handler
        async function handleLogin(event) {
            event.preventDefault();
            
            const email = document.getElementById('login-email').value.trim();
            const password = document.getElementById('login-password').value;

            // Clear previous errors
            clearError('login-email');
            clearError('login-password');
            document.getElementById('login-message').classList.add('hidden');

            // Validate
            let hasError = false;
            
            if (!email) {
                showError('login-email', 'Email is required');
                hasError = true;
            } else if (!validateEmail(email)) {
                showError('login-email', 'Please enter a valid email');
                hasError = true;
            }

            if (!password) {
                showError('login-password', 'Password is required');
                hasError = true;
            }

            if (hasError) return;

            try {
                showMessage('login-message', 'Logging in...', false);
                
                // Call login API
                const response = await fetch(`${API_BASE_URL}/api/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ email, password })
                });

                const data = await response.json();

                if (response.ok) {
                    // Save user data to localStorage
                    localStorage.setItem('foodgenie-user', JSON.stringify(data.user));
                    localStorage.setItem('foodgenie-token', data.token);
                    
                    showMessage('login-message', 'Login successful! Redirecting...', false);
                    
                    // Redirect to dashboard
                    setTimeout(() => {
                        window.location.href = 'dashboard.html';
                    }, 1000);
                } else {
                    showMessage('login-message', data.detail || 'Login failed. Please check your credentials.', true);
                }
            } catch (error) {
                console.error('Login error:', error);
                showMessage('login-message', 'Connection error. Please make sure the backend server is running.', true);
            }
        }

        // Signup Handler
        async function handleSignup(event) {
            event.preventDefault();
            
            const name = document.getElementById('signup-name').value.trim();
            const email = document.getElementById('signup-email').value.trim();
            const password = document.getElementById('signup-password').value;
            const city = document.getElementById('signup-city').value;

            // Clear previous errors
            clearError('signup-name');
            clearError('signup-email');
            clearError('signup-password');
            document.getElementById('signup-message').classList.add('hidden');

            // Validate
            let hasError = false;
            
            if (!name) {
                showError('signup-name', 'Name is required');
                hasError = true;
            }

            if (!email) {
                showError('signup-email', 'Email is required');
                hasError = true;
            } else if (!validateEmail(email)) {
                showError('signup-email', 'Please enter a valid email');
                hasError = true;
            }

            if (!password) {
                showError('signup-password', 'Password is required');
                hasError = true;
            } else if (password.length < 6) {
                showError('signup-password', 'Password must be at least 6 characters');
                hasError = true;
            }

            if (hasError) return;

            try {
                showMessage('signup-message', 'Creating your account...', false);
                
                // Call signup API
                const response = await fetch(`${API_BASE_URL}/api/auth/signup`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email,
                        password,
                        user_name: name,
                        family_size: 1,
                        city
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    // Save user data to localStorage
                    localStorage.setItem('foodgenie-user', JSON.stringify(data.user));
                    localStorage.setItem('foodgenie-token', data.token);
                    
                    showMessage('signup-message', 'Account created successfully! Redirecting to setup...', false);
                    
                    // Redirect to onboarding
                    setTimeout(() => {
                        window.location.href = 'onboarding.html';
                    }, 1000);
                } else {
                    showMessage('signup-message', data.detail || 'Signup failed. Please try again.', true);
                }
            } catch (error) {
                console.error('Signup error:', error);
                showMessage('signup-message', 'Connection error. Please make sure the backend server is running.', true);
            }
        }

        // Check if user is already logged in
        window.addEventListener('DOMContentLoaded', () => {
            const user = localStorage.getItem('foodgenie-user');
            if (user) {
                window.location.href = 'dashboard.html';
            }
        });
    </script>
</body>
</html>
